<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>

    <ion-title>Historial Cliente</ion-title>
  </ion-toolbar>  
</ion-header>


<ion-content>
  <ion-grid>    
    <ion-card *ngIf="datosCliente">
      <ion-row>
        <ion-col size="12" size-sm="12" size-md="6" size-lg="6" size-xl="6">
          <ion-item>             
            <ion-avatar slot="start" *ngIf="datosCliente[0].data.tipo=='adulto'">
              <img src="assets/imgs/icono_user_default.png">
            </ion-avatar>
            <ion-avatar slot="start" *ngIf="datosCliente[0].data.tipo=='menor'">
              <img src="assets/imgs/child-icon.png">
            </ion-avatar>
            
            <ion-label>
              <h2 textwrap>{{datosCliente[0]?.data.nombres}} {{datosCliente[0].data.apellidos}}</h2>                    
              <p style="color:#999999;">cel. {{datosCliente[0]?.data.telefono}}</p>
              <p style="color:#999999;">email: {{datosCliente[0]?.data.email}}</p>
              <p style="color:#999999;">DNI: {{datosCliente[0]?.data.dni}}</p>
              <p style="color:#999999;" *ngIf="datosCliente[0]?.dataNumero!=undefined">#Veces atendido: {{datosCliente[0]?.dataNumero.nro_placas}}</p>
              <p style="color:#999999;" *ngIf="datosCliente[0]?.dataNumero==undefined">#Veces atendido: 0</p>  
            </ion-label>          
          </ion-item>
        </ion-col>
      </ion-row>
    </ion-card>
    <ion-row *ngIf="historialCliente">
      <ion-col size="12" class="ion-text-center" color="dark"><h2>Historial</h2></ion-col>
      <ion-col *ngFor="let item of historialCliente | async | orderBy:'fecha':true" size="12" size-sm="12" size-md="6" size-lg="4" size-xl="4">
        <ion-card>
          <ion-item class="cancelado">
            <ion-avatar slot="start">
              <img *ngIf="item.dataPlaca.tipo_cliente=='menor'" src="assets/imgs/child-icon.png">
              <img *ngIf="item.dataPlaca.tipo_cliente=='adulto'" src="assets/imgs/icono_user_default.png">
            </ion-avatar>

            <ion-label>
              <h2>{{item.dataPlaca.nombre_cliente}}</h2>
              <p>{{mostrarFecha(item.dataPlaca.fecha)}}</p>
            </ion-label>         
          </ion-item>
          <ion-row>  
            <ion-col class="ion-text-left">
              <ion-button (click)="callDoctor(item.dataPlaca.doctor)" fill="clear" size="small" color="primary">  
                <ion-icon slot="start" color="primary" name="call"></ion-icon>              
                <div style="text-transform:none;">Llamar doctor</div>
              </ion-button>
            </ion-col>                                    
            <ion-col class="ion-text-right">
              <ion-button (click)="callCliente(item.dataPlaca.cliente)" *ngIf="item.dataPlaca.tipo_cliente=='adulto'" fill="clear" size="small" color="primary">
                <ion-icon slot="start" color="primary" name="call"></ion-icon>
                <div style="text-transform:none;">Llamar cliente</div>
              </ion-button>
              <ion-button (click)="mostrarTutores(item.dataPlaca.cliente)" *ngIf="item.dataPlaca.tipo_cliente=='menor'" fill="clear" size="small" color="primary">
                <ion-icon slot="start" color="primary" name="call"></ion-icon>
                <div style="text-transform:none;">Llamar padres</div>
              </ion-button>
            </ion-col>                  
          </ion-row>  
          <img *ngIf="item.dataPlaca.imagenes" (click)="mostrarPlacas(item.data.placa)" src="assets/imgs/radiografia.jpg"/>
          <ion-card-content>
            <p class="ion-text-wrap"><b>Doctor:</b> {{item.dataPlaca.nombre_doctor}}  <span *ngIf="item.dataPlaca.puntos_ganados>0" style="color:#32db64;">+{{item.dataPlaca.puntos_ganados}} pts.</span>  <span *ngIf="item.dataPlaca.puntos_usados>0" style="color:#f53d3d;">-{{item.dataPlaca.puntos_usados}} pts.</span></p>
            <p class="ion-text-wrap">Atendido en: <b>Ceradent</b> - {{item.dataPlaca.nombre_sucursal}}</p>
            <p class="ion-text-wrap"><b>Placas:</b> {{item.dataPlaca.nombres_servicios}}</p>
          </ion-card-content>    
          <ion-row> 
            <ion-col *ngIf="item.dataPlaca.duplicado">
              <ion-button fill="clear" size="small" color="dark">                
                <div>Duplicado</div>
              </ion-button>
            </ion-col>   
            <ion-col *ngIf="item.dataPlaca.monto_efectivo+item.dataPlaca.monto_tarjeta<item.dataPlaca.monto">
              <ion-button fill="clear" size="small" color="danger">  
                <ion-icon color="danger" name="cash"></ion-icon>              
                <div >S/.{{item.dataPlaca.monto-item.dataPlaca.monto_efectivo-item.dataPlaca.monto_tarjeta}}</div>
              </ion-button>
            </ion-col>                       
            <ion-col *ngIf="item.dataPlaca.imagenes" class="ion-text-right">
              <ion-button (click)="mostrarPlacas(item.data.placa)" fill="clear" size="small">
                <ion-icon slot="start" name="albums"></ion-icon>
                <div>ver Placas</div>
              </ion-button>
            </ion-col>            
          </ion-row>  
          <ion-row *ngIf="item.dataPlaca.descuento>0">
            <ion-col style="background-color:beige; padding:1rem;">
              <p class="ion-text-wrap"><b>Descuento:</b> {{item.dataPlaca.descuento | currency:'S/. '}} - {{item.dataPlaca.motivo_descuento}}</p>
            </ion-col>
            </ion-row>      
        </ion-card>  
      </ion-col>
    </ion-row>    
  </ion-grid>
</ion-content>